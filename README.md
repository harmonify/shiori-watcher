# Bookmark Watcher with ArchiveBox and Go-Shiori

This project integrates [ArchiveBox](https://github.com/ArchiveBox/ArchiveBox) and [Go-Shiori](https://github.com/go-shiori/shiori) by creating a lightweight Docker container that watches a PostgreSQL database for new entries in the `bookmarks` table used by [Go-Shiori](https://github.com/go-shiori/shiori). When new entries are added, the container fetches the URLs and adds them to [ArchiveBox](https://github.com/ArchiveBox/ArchiveBox) for archiving.

## Prerequisites

- Docker
- Docker Compose

## Usage

### Step 1: Clone the Repository

```bash
git clone https://github.com/harmonify/shiori-watcher.git
cd shiori-watcher
```

### Step 2: Build and Run the Docker Containers

Build and start the Docker containers using Docker Compose:

```bash
docker-compose up --build
```

This will start the following services:

- **Postgres**: PostgreSQL database for storing bookmarks.
- **ArchiveBox**: Service for archiving URLs.
- **Go-Shiori**: Bookmark manager.
- **Watcher**: Service that watches the bookmarks table and triggers ArchiveBox for new URLs.

### Configuration

The watcher service uses the following environment variables for configuration:

- `DB_NAME`: Name of the PostgreSQL database (default: `mydb`).
- `DB_USER`: PostgreSQL user (default: `myuser`).
- `DB_PASSWORD`: PostgreSQL password (default: `mypassword`).
- `DB_HOST`: PostgreSQL host (default: `postgres`).
- `DB_PORT`: PostgreSQL port (default: `5432`).
- `ARCHIVEBOX_CONTAINER_NAME`: Name of the ArchiveBox container (default: `archivebox`).
- `DATA_DIR`: Directory for storing temporary URL files (default: `/data`).
- `LOGS_DIR`: Directory for storing log files (default: `/logs`).

### Volumes

The following volumes are used to persist data:

- `postgres_data`: Stores PostgreSQL data.
- `archivebox_data`: Stores ArchiveBox data.
- `shiori_data`: Stores Go-Shiori data.
- `watcher_logs`: Stores logs generated by the watcher service.

### Example Docker Compose Configuration

Below is the `docker-compose.yml` file configuration:

```yaml
version: "3"

services:
  postgres:
    image: postgres:latest
    environment:
      POSTGRES_USER: myuser
      POSTGRES_PASSWORD: mypassword
      POSTGRES_DB: mydb
    volumes:
      - postgres_data:/var/lib/postgresql/data

  archivebox:
    image: archivebox/archivebox:latest
    volumes:
      - archivebox_data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - ALLOWED_HOSTS=*
      - USE_COLOR=true
    depends_on:
      - postgres

  shiori:
    image: go-shiori/shiori:latest
    ports:
      - "8080:8080"
    volumes:
      - shiori_data:/srv/shiori

  watcher:
    build: ./watcher
    environment:
      - DB_NAME=mydb
      - DB_USER=myuser
      - DB_PASSWORD=mypassword
      - DB_HOST=postgres
      - DB_PORT=5432
      - ARCHIVEBOX_CONTAINER_NAME=archivebox
      - DATA_DIR=/data
      - LOGS_DIR=/logs
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - archivebox_data:/data
      - watcher_logs:/logs
    depends_on:
      - postgres
      - archivebox

volumes:
  postgres_data:
  archivebox_data:
  shiori_data:
  watcher_logs:
```

## Contributing

Contributions are welcome! Follow these steps to contribute:

1. Fork the repository.
2. Create a new branch for your feature or bug fix.
3. Commit your changes and push your branch to GitHub.
4. Open a pull request describing your changes.

### Development Setup

To set up a development environment:

1. Clone the repository:

   ```bash
   git clone https://github.com/harmonify/shiori-watcher.git
   cd shiori-watcher
   ```

2. Install dependencies:

   ```bash
   cd watcher
   pip install -r requirements.txt
   ```

3. Run the watcher script locally:

   ```bash
   python watcher.py
   ```

Ensure you have a PostgreSQL instance running and accessible with the required database and table set up.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
